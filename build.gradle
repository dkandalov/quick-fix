buildscript {
	ext.kotlin_version = "1.4.0"
	repositories {
		mavenCentral()
		maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
	}
}
plugins {
	id "org.jetbrains.intellij" version "1.1.2"
	id "org.jetbrains.kotlin.jvm" version "1.4.0"
}
apply plugin:"java"
apply plugin:"kotlin"
apply plugin:"idea"
apply plugin:"org.jetbrains.intellij"

repositories {
	mavenCentral()
}

dependencies {
	testCompile "junit:junit:4.11" // also includes hamcrest-core
}

sourceSets {
	main {
		kotlin.srcDir "src"
		resources.srcDir "resources"
	}
	test {
		kotlin.srcDir "test"
	}
}

compileKotlin {
	kotlinOptions {
		jvmTarget = "11"
		apiVersion = "1.4"
		languageVersion = "1.4"
        // Compiler flag to allow building against pre-released versions of Kotlin
        // because IJ EAP can be built using pre-released Kotlin but it's still worth doing to check API compatibility
        freeCompilerArgs = ["-Xskip-metadata-version-check"] 
    }
}

intellij {
	// To find available IDE versions see https://www.jetbrains.com/intellij-repository/releases
	// and https://www.jetbrains.com/intellij-repository/snapshots
	version = System.getenv().getOrDefault("IJ_VERSION",
			"203.5981.155", // Version which contains CustomizableIntentionAction
//			"LATEST-EAP-SNAPSHOT"
	)
	downloadSources = true
	sameSinceUntilBuild = false
	updateSinceUntilBuild = false
}
